import { BezierTool, ToolMode } from './BezierTool.js';
import { PointArrayInputHandler, InputHandler, PointInputHandler, InitializerInputHandler } from "./ToolInputHandler.js";
const pointNearPoint = BezierTool.pointNearPoint;
const PI2 = Math.PI * 2;
// Helper function log outputs
// function degrees(radians: number) { return (radians / Math.PI) * 180.0; }
class InitializerIH extends InitializerInputHandler {
	constructor(tool, success, fail) {
		super(tool.lineA, tool.lineB, success, fail);
	}
}
export default class CircleTool extends BezierTool {
	constructor() {
		super(...arguments);
		this.lineA = new PIXI.Point();
		this.lineB = new PIXI.Point();
		this.arcHandle = new RotatorHandle(100);
		this.sliceHandle = new RotatorHandle(75, this.arcHandle);
	}
	get handles() { return [this.lineA, this.lineB]; }
	get bounds() {
		const b = new PIXI.Bounds();
		b.addPoint(this.lineA);
		b.addPoint(this.lineB);
		return b;
	}
	get polygon() {
		const bounds = this.bounds;
		return new PIXI.Polygon([
			bounds.minX, bounds.minY,
			bounds.maxX, bounds.minY,
			bounds.minX, bounds.maxY,
			bounds.maxX, bounds.maxY
		]);
	}
	getTools() {
		return [{
				icon: 'fas fa-adjust',
				name: 'ellipseclose',
				title: 'df-curvy-walls.ellipse_close',
				class: 'toggle' + (CircleTool.closeLoopIfSliced ? ' active' : ''),
				style: 'display:none',
				onClick: (button) => {
					var enabled = button.hasClass('active');
					CircleTool.closeLoopIfSliced = !enabled;
					if (enabled)
						button.removeClass('active');
					else
						button.addClass('active');
					Hooks.call('requestCurvyWallsRedraw');
				}
			}, {
				icon: 'fas fa-compress-alt',
				name: 'ellipsefinish',
				title: 'df-curvy-walls.ellipse_finish_slice',
				class: 'toggle' + (CircleTool.finishSliceIfShort ? ' active' : ''),
				style: 'display:none',
				onClick: (button) => {
					var enabled = button.hasClass('active');
					CircleTool.finishSliceIfShort = !enabled;
					if (enabled)
						button.removeClass('active');
					else
						button.addClass('active');
					Hooks.call('requestCurvyWallsRedraw');
				}
			}, {
				icon: '',
				name: 'ellipseinc',
				title: 'df-curvy-walls.ellipse_increment',
				class: '',
				style: 'display:none',
				html: '<div class="ellipseinc"></div>',
				onClick: () => {
					CircleTool.snapSetIndex = Math.clamped(CircleTool.snapSetIndex + 1, 0, CircleTool.ANGLE_SNAP_STEPS.length - 1);
					Hooks.call('requestCurvyWallsRedraw');
				}
			}, {
				icon: '',
				name: 'ellipsedec',
				title: 'df-curvy-walls.ellipse_decrement',
				style: 'display:none',
				html: '<div class="ellipsedec"></div>',
				onClick: () => {
					CircleTool.snapSetIndex = Math.clamped(CircleTool.snapSetIndex - 1, 0, CircleTool.ANGLE_SNAP_STEPS.length - 1);
					Hooks.call('requestCurvyWallsRedraw');
				}
			}];
	}
	showTools() {
		$(`button[data-tool="ellipseclose"]`).show();
		$(`button[data-tool="ellipsefinish"]`).show();
		$(`button[data-tool="ellipseinc"]`).show();
		$(`button[data-tool="ellipsedec"]`).show();
	}
	hideTools() {
		$(`button[data-tool="ellipseclose"]`).hide();
		$(`button[data-tool="ellipsefinish"]`).hide();
		$(`button[data-tool="ellipseinc"]`).hide();
		$(`button[data-tool="ellipsedec"]`).hide();
	}
	getCenter() {
		const bounds = this.bounds;
		const rect = bounds.getRectangle(PIXI.Rectangle.EMPTY);
		var halfWidth = rect.width / 2;
		var halfHeight = rect.height / 2;
		return new PIXI.Point(bounds.minX + halfWidth, bounds.minY + halfHeight);
	}
	createVector(theta, magnitude, origin) {
		return new PIXI.Point(origin.x + (Math.cos(theta) * magnitude.x), origin.y + (Math.sin(theta) * magnitude.y));
	}
	getSegments(count) {
		if (this.mode == ToolMode.NotPlaced)
			return [];
		const bounds = this.bounds;
		const rect = bounds.getRectangle(PIXI.Rectangle.EMPTY);
		var deltaTheta = Math.PI / count;
		// Calculate the magnitude per axis based on the scalar of the circle's x,y radius
		const magnitude = new PIXI.Point(rect.width / 2, rect.height / 2);
		// Find the exact middle point of the circle
		const origin = new PIXI.Point(bounds.minX + magnitude.x, bounds.minY + magnitude.y);
		// initialize with the first point
		const points = [];
		// Start at full rotation and work our way back CCW
		var angle = PI2;
		var sliceAngle = this.sliceHandle.rawAngle != PI2 ? this.sliceHandle.rawAngle : 0.0;
		// console.log(`Slice: ${degrees(sliceAngle)}, Arc: ${degrees(this.arcHandle.rawAngle)}`);
		while (angle >= sliceAngle) {
			points.push(this.createVector(this.arcHandle.rawAngle + angle, magnitude, origin));
			angle -= deltaTheta;
		}
		// If we stopped short of the slice handle, add a small step to go the rest of the way
		if (CircleTool.finishSliceIfShort && angle != sliceAngle && sliceAngle != 0) {
			points.push(this.createVector(this.arcHandle.rawAngle + sliceAngle, magnitude, origin));
		}
		// Close loop if there is no slice, or if the user has locked loop closing
		if (CircleTool.closeLoopIfSliced && sliceAngle != 0)
			points.push(points[0]);
		return (this.lastSegmentFetch = points);
	}
	initialPoints() { return [0, 0, 0, 0, 0, 0]; }
	drawHandles(context) {
		if (this.mode == ToolMode.NotPlaced)
			return;
		this.drawBoundingBox(context);
		const middle = this.getCenter();
		const arc = this.arcHandle.getHandlePoint(middle);
		const slice = this.sliceHandle.getHandlePoint(middle);
		context.beginFill(0xffaacc)
			.lineStyle(BezierTool.LINE_SIZE, 0xffaacc, 1, 0.5)
			.moveTo(this.lineA.x, this.lineA.y)
			.lineTo(this.lineB.x, this.lineB.y)
			.moveTo(middle.x, middle.y)
			.lineTo(arc.x, arc.y)
			.moveTo(middle.x, middle.y)
			.lineTo(slice.x, slice.y)
			.endFill();
		this.drawSegmentLabel(context);
		const snapAngle = toDegrees(CircleTool.ANGLE_SNAP_STEPS[CircleTool.snapSetIndex]).toFixed(2);
		const arcLabel = BezierTool.createText(`⇲${snapAngle}°   ◶${180 / parseFloat(snapAngle)}`);
		arcLabel.position.copyFrom(this.lineCenter);
		arcLabel.position.y += BezierTool.TEXT_STYLE.fontSize + 4;
		context.addChild(arcLabel);
		this.drawHandle(context, 0xff4444, this.lineA);
		this.drawHandle(context, 0xff4444, this.lineB);
		this.drawHandle(context, 0x44ff44, this.arcHandle.getHandlePoint(this.getCenter()));
		this.drawHandle(context, 0x4444ff, this.sliceHandle.getHandlePoint(this.getCenter()));
	}
	drawSegmentLabel(context) {
		const text = BezierTool.createText(`↔${this.lastSegmentFetch.length - 1}`);
		text.position = this.lineCenter;
		context.addChild(text);
	}
	checkPointForDrag(point) {
		if (this.mode == ToolMode.NotPlaced) {
			this.setMode(ToolMode.Placing);
			return new InitializerIH(this, () => this.setMode(ToolMode.Placed), () => this.setMode(ToolMode.NotPlaced));
		}
		if (pointNearPoint(point, this.lineA, BezierTool.HANDLE_RADIUS))
			return new PointInputHandler(this.lineA);
		else if (pointNearPoint(point, this.lineB, BezierTool.HANDLE_RADIUS))
			return new PointInputHandler(this.lineB);
		else if (pointNearPoint(point, this.arcHandle.getHandlePoint(this.getCenter()), BezierTool.HANDLE_RADIUS))
			return new PointRotationHandler(this.arcHandle, this.getCenter());
		else if (pointNearPoint(point, this.sliceHandle.getHandlePoint(this.getCenter()), BezierTool.HANDLE_RADIUS))
			return new PointRotationHandler(this.sliceHandle, this.getCenter());
		else if (this.polygon.contains(point.x, point.y))
			return new PointArrayInputHandler(point, this.handles);
		return null;
	}
}
CircleTool.ANGLE_SNAP_STEPS = [Math.PI / 4, Math.PI / 6, Math.PI / 12, Math.PI / 24, Math.PI / 48];
CircleTool.snapSetIndex = 2;
CircleTool.finishSliceIfShort = true;
CircleTool.closeLoopIfSliced = false;
class RotatorHandle {
	constructor(length, magnet) {
		this._angle = 0.0;
		this.length = 0.0;
		this.length = length;
		this.magnet = magnet;
	}
	get rawAngle() { return this._angle; }
	set rawAngle(value) { this._angle = value; }
	get angle() {
		return !!this.magnet ? this._angle + this.magnet._angle : this._angle;
	}
	set angle(value) {
		this._angle = !!this.magnet ? value - this.magnet._angle : this._angle = value;
	}
	getHandlePoint(center) {
		const magnet = !!this.magnet ? this.magnet._angle : 0;
		const ax = Math.cos(magnet + this._angle) * this.length;
		const ay = Math.sin(magnet + this._angle) * this.length;
		return new PIXI.Point(center.x + ax, center.y + ay);
	}
}
class PointRotationHandler extends InputHandler {
	constructor(arcHandle, center) {
		super();
		this.arcHandle = arcHandle;
		this.original = this.arcHandle.angle;
		this.center = center;
	}
	setAngle(to, event) {
		const vecX = to.x - this.center.x;
		const vecY = to.y - this.center.y;
		// calculate the reference angle theta bar (͞θ)
		var angle = Math.atan(vecY / vecX);
		// If on the -X axis (2nd and 3rd quadrants)
		if (vecX < 0)
			angle += Math.PI;
		// Specifically the +X,-Y quadrant (4th quadrant)
		else if (vecY < 0)
			angle += PI2;
		// Perform snapping if enabled
		if (this.shouldSnap(event)) {
			const snapAngle = CircleTool.ANGLE_SNAP_STEPS[CircleTool.snapSetIndex];
			// Whole number of angle snaps
			const whole = Math.trunc(angle / snapAngle);
			// Round to the nearest whole angle snap
			angle = (angle - (whole * snapAngle)) < (snapAngle / 2)
				? whole * snapAngle
				: (whole + 1) * snapAngle;
		}
		const magnet = !!this.arcHandle.magnet ? (PI2 - this.arcHandle.magnet.rawAngle) : 0;
		this.arcHandle.rawAngle = (magnet + angle) % PI2;
	}
	start(_origin, destination, event) {
		this.setAngle(destination, event);
	}
	move(_origin, destination, event) {
		this.setAngle(destination, event);
	}
	stop(_origin, destination, event) {
		this.setAngle(destination, event);
	}
	cancel() {
		this.arcHandle.angle = this.original;
	}
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2RmLWN1cnZ5LXdhbGxzL3NyYy90b29scy9DaXJjbGVUb29sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFdkQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLFlBQVksRUFBRSxpQkFBaUIsRUFBRSx1QkFBdUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRXpILE1BQU0sY0FBYyxHQUFHLFVBQVUsQ0FBQyxjQUFjLENBQUM7QUFDakQsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUE7QUFHdkIsOEJBQThCO0FBQzlCLDRFQUE0RTtBQUU1RSxNQUFNLGFBQWMsU0FBUSx1QkFBdUI7SUFDbEQsWUFBWSxJQUFnQixFQUFFLE9BQW1CLEVBQUUsSUFBZ0I7UUFDbEUsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDN0MsQ0FBQztDQUNEO0FBRUQsTUFBTSxDQUFDLE9BQU8sT0FBTyxVQUFXLFNBQVEsVUFBVTtJQUFsRDs7UUFLQyxVQUFLLEdBQUcsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDekIsVUFBSyxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3pCLGNBQVMsR0FBRyxJQUFJLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQyxnQkFBVyxHQUFHLElBQUksYUFBYSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUE4S3JELENBQUM7SUE1S0EsSUFBSSxPQUFPLEtBQWMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMzRCxJQUFJLE1BQU07UUFDVCxNQUFNLENBQUMsR0FBRyxJQUFJLElB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QUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ25GLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxHQUFHLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxHQUFHLEdBQUcsQ0FBQztJQUNsRCxDQUFDO0lBRUQsS0FBSyxDQUFDLE9BQW1CLEVBQUUsV0FBdUIsRUFBRSxLQUE0QjtRQUMvRSxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ0QsSUFBSSxDQUFDLE9BQW1CLEVBQUUsV0FBdUIsRUFBRSxLQUE0QjtRQUM5RSxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ0QsSUFBSSxDQUFDLE9BQW1CLEVBQUUsV0FBdUIsRUFBRSxLQUE0QjtRQUM5RSxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ0QsTUFBTTtRQUNMLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDdEMsQ0FBQztDQUNEIiwiZmlsZSI6InRvb2xzL0NpcmNsZVRvb2wuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IEJlemllclRvb2wsIFRvb2xNb2RlIH0gZnJvbSAnLi9CZXppZXJUb29sLmpzJztcbmltcG9ydCB7IFRvb2xVSSB9IGZyb20gJy4uL0JlemllclRvb2xCYXIuanMnO1xuaW1wb3J0IHsgUG9pbnRBcnJheUlucHV0SGFuZGxlciwgSW5wdXRIYW5kbGVyLCBQb2ludElucHV0SGFuZGxlciwgSW5pdGlhbGl6ZXJJbnB1dEhhbmRsZXIgfSBmcm9tIFwiLi9Ub29sSW5wdXRIYW5kbGVyLmpzXCI7XG5cbmNvbnN0IHBvaW50TmVhclBvaW50ID0gQmV6aWVyVG9vbC5wb2ludE5lYXJQb2ludDtcbmNvbnN0IFBJMiA9IE1hdGguUEkgKiAyXG5kZWNsYXJlIHR5cGUgUG9pbnQgPSBQSVhJLlBvaW50O1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gbG9nIG91dHB1dHNcbi8vIGZ1bmN0aW9uIGRlZ3JlZXMocmFkaWFuczogbnVtYmVyKSB7IHJldHVybiAocmFkaWFucyAvIE1hdGguUEkpICogMTgwLjA7IH1cblxuY2xhc3MgSW5pdGlhbGl6ZXJJSCBleHRlbmRzIEluaXRpYWxpemVySW5wdXRIYW5kbGVyIHtcblx0Y29uc3RydWN0b3IodG9vbDogQ2lyY2xlVG9vbCwgc3VjY2VzczogKCkgPT4gdm9pZCwgZmFpbDogKCkgPT4gdm9pZCkge1xuXHRcdHN1cGVyKHRvb2wubGluZUEsIHRvb2wubGluZUIsIHN1Y2Nlc3MsIGZhaWwpXG5cdH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2lyY2xlVG9vbCBleHRlbmRzIEJlemllclRvb2wge1xuXHRzdGF0aWMgcmVhZG9ubHkgQU5HTEVfU05BUF9TVEVQUyA9IFtNYXRoLlBJIC8gNCwgTWF0aC5QSSAvIDYsIE1hdGguUEkgLyAxMiwgTWF0aC5QSSAvIDI0LCBNYXRoLlBJIC8gNDhdO1xuXHRzdGF0aWMgc25hcFNldEluZGV4ID0gMjtcblx0c3RhdGljIGZpbmlzaFNsaWNlSWZTaG9ydCA9IHRydWU7XG5cdHN0YXRpYyBjbG9zZUxvb3BJZlNsaWNlZCA9IGZhbHNlO1xuXHRsaW5lQSA9IG5ldyBQSVhJLlBvaW50KCk7XG5cdGxpbmVCID0gbmV3IFBJWEkuUG9pbnQoKTtcblx0YXJjSGFuZGxlID0gbmV3IFJvdGF0b3JIYW5kbGUoMTAwKTtcblx0c2xpY2VIYW5kbGUgPSBuZXcgUm90YXRvckhhbmRsZSg3NSwgdGhpcy5hcmNIYW5kbGUpO1xuXG5cdGdldCBoYW5kbGVzKCk6IFBvaW50W10geyByZXR1cm4gW3RoaXMubGluZUEsIHRoaXMubGluZUJdOyB9XG5cdGdldCBib3VuZHMoKTogUElYSS5Cb3VuZHMge1xuXHRcdGNvbnN0IGIgPSBuZXcgUElYSS5Cb3VuZHMoKTtcblx0XHRiLmFkZFBvaW50KHRoaXMubGluZUEpO1xuXHRcdGIuYWRkUG9pbnQodGhpcy5saW5lQik7XG5cdFx0cmV0dXJuIGI7XG5cdH1cblx0Z2V0IHBvbHlnb24oKTogUElYSS5Qb2x5Z29uIHtcblx0XHRjb25zdCBib3VuZHMgPSB0aGlzLmJvdW5kcztcblx0XHRyZXR1cm4gbmV3IFBJWEkuUG9seWdvbihbXG5cdFx0XHRib3VuZHMubWluWCwgYm91bmRzLm1pblksXG5cdFx0XHRib3VuZHMubWF4WCwgYm91bmRzLm1pblksXG5cdFx0XHRib3VuZHMubWluWCwgYm91bmRzLm1heFksXG5cdFx0XHRib3VuZHMubWF4WCwgYm91bmRzLm1heFldKTtcblx0fVxuXG5cdGdldFRvb2xzKCk6IFRvb2xVSVtdIHtcblx0XHRyZXR1cm4gW3tcblx0XHRcdGljb246ICdmYXMgZmEtYWRqdXN0Jyxcblx0XHRcdG5hbWU6ICdlbGxpcHNlY2xvc2UnLFxuXHRcdFx0dGl0bGU6ICdkZi1jdXJ2eS13YWxscy5lbGxpcHNlX2Nsb3NlJyxcblx0XHRcdGNsYXNzOiAndG9nZ2xlJyArIChDaXJjbGVUb29sLmNsb3NlTG9vcElmU2xpY2VkID8gJyBhY3RpdmUnIDogJycpLFxuXHRcdFx0c3R5bGU6ICdkaXNwbGF5Om5vbmUnLFxuXHRcdFx0b25DbGljazogKGJ1dHRvbikgPT4ge1xuXHRcdFx0XHR2YXIgZW5hYmxlZCA9IGJ1dHRvbi5oYXNDbGFzcygnYWN0aXZlJyk7XG5cdFx0XHRcdENpcmNsZVRvb2wuY2xvc2VMb29wSWZTbGljZWQgPSAhZW5hYmxlZDtcblx0XHRcdFx0aWYgKGVuYWJsZWQpIGJ1dHRvbi5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG5cdFx0XHRcdGVsc2UgYnV0dG9uLmFkZENsYXNzKCdhY3RpdmUnKTtcblx0XHRcdFx0SG9va3MuY2FsbCgncmVxdWVzdEN1cnZ5V2FsbHNSZWRyYXcnKTtcblx0XHRcdH1cblx0XHR9LCB7XG5cdFx0XHRpY29uOiAnZmFzIGZhLWNvbXByZXNzLWFsdCcsXG5cdFx0XHRuYW1lOiAnZWxsaXBzZWZpbmlzaCcsXG5cdFx0XHR0aXRsZTogJ2RmLWN1cnZ5LXdhbGxzLmVsbGlwc2VfZmluaXNoX3NsaWNlJyxcblx0XHRcdGNsYXNzOiAndG9nZ2xlJyArIChDaXJjbGVUb29sLmZpbmlzaFNsaWNlSWZTaG9ydCA/ICcgYWN0aXZlJyA6ICcnKSxcblx0XHRcdHN0eWxlOiAnZGlzcGxheTpub25lJyxcblx0XHRcdG9uQ2xpY2s6IChidXR0b24pID0+IHtcblx0XHRcdFx0dmFyIGVuYWJsZWQgPSBidXR0b24uaGFzQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0XHRDaXJjbGVUb29sLmZpbmlzaFNsaWNlSWZTaG9ydCA9ICFlbmFibGVkO1xuXHRcdFx0XHRpZiAoZW5hYmxlZCkgYnV0dG9uLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcblx0XHRcdFx0ZWxzZSBidXR0b24uYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0XHRIb29rcy5jYWxsKCdyZXF1ZXN0Q3VydnlXYWxsc1JlZHJhdycpO1xuXHRcdFx0fVxuXHRcdH0sIHtcblx0XHRcdGljb246ICcnLFxuXHRcdFx0bmFtZTogJ2VsbGlwc2VpbmMnLFxuXHRcdFx0dGl0bGU6ICdkZi1jdXJ2eS13YWxscy5lbGxpcHNlX2luY3JlbWVudCcsXG5cdFx0XHRjbGFzczogJycsXG5cdFx0XHRzdHlsZTogJ2Rpc3BsYXk6bm9uZScsXG5cdFx0XHRodG1sOiAnPGRpdiBjbGFzcz1cImVsbGlwc2VpbmNcIj48L2Rpdj4nLFxuXHRcdFx0b25DbGljazogKCkgPT4ge1xuXHRcdFx0XHRDaXJjbGVUb29sLnNuYXBTZXRJbmRleCA9IE1hdGguY2xhbXBlZChDaXJjbGVUb29sLnNuYXBTZXRJbmRleCArIDEsIDAsIENpcmNsZVRvb2wuQU5HTEVfU05BUF9TVEVQUy5sZW5ndGggLSAxKTtcblx0XHRcdFx0SG9va3MuY2FsbCgncmVxdWVzdEN1cnZ5V2FsbHNSZWRyYXcnKTtcblx0XHRcdH1cblx0XHR9LCB7XG5cdFx0XHRpY29uOiAnJyxcblx0XHRcdG5hbWU6ICdlbGxpcHNlZGVjJyxcblx0XHRcdHRpdGxlOiAnZGYtY3Vydnktd2FsbHMuZWxsaXBzZV9kZWNyZW1lbnQnLFxuXHRcdFx0c3R5bGU6ICdkaXNwbGF5Om5vbmUnLFxuXHRcdFx0aHRtbDogJzxkaXYgY2xhc3M9XCJlbGxpcHNlZGVjXCI+PC9kaXY+Jyxcblx0XHRcdG9uQ2xpY2s6ICgpID0+IHtcblx0XHRcdFx0Q2lyY2xlVG9vbC5zbmFwU2V0SW5kZXggPSBNYXRoLmNsYW1wZWQoQ2lyY2xlVG9vbC5zbmFwU2V0SW5kZXggLSAxLCAwLCBDaXJjbGVUb29sLkFOR0xFX1NOQVBfU1RFUFMubGVuZ3RoIC0gMSk7XG5cdFx0XHRcdEhvb2tzLmNhbGwoJ3JlcXVlc3RDdXJ2eVdhbGxzUmVkcmF3Jyk7XG5cdFx0XHR9XG5cdFx0fV07XG5cdH1cblx0c2hvd1Rvb2xzKCkge1xuXHRcdCQoYGJ1dHRvbltkYXRhLXRvb2w9XCJlbGxpcHNlY2xvc2VcIl1gKS5zaG93KCk7XG5cdFx0JChgYnV0dG9uW2RhdGEtdG9vbD1cImVsbGlwc2VmaW5pc2hcIl1gKS5zaG93KCk7XG5cdFx0JChgYnV0dG9uW2RhdGEtdG9vbD1cImVsbGlwc2VpbmNcIl1gKS5zaG93KCk7XG5cdFx0JChgYnV0dG9uW2RhdGEtdG9vbD1cImVsbGlwc2VkZWNcIl1gKS5zaG93KCk7XG5cdH1cblx0aGlkZVRvb2xzKCkge1xuXHRcdCQoYGJ1dHRvbltkYXRhLXRvb2w9XCJlbGxpcHNlY2xvc2VcIl1gKS5oaWRlKCk7XG5cdFx0JChgYnV0dG9uW2RhdGEtdG9vbD1cImVsbGlwc2VmaW5pc2hcIl1gKS5oaWRlKCk7XG5cdFx0JChgYnV0dG9uW2RhdGEtdG9vbD1cImVsbGlwc2VpbmNcIl1gKS5oaWRlKCk7XG5cdFx0JChgYnV0dG9uW2RhdGEtdG9vbD1cImVsbGlwc2VkZWNcIl1gKS5oaWRlKCk7XG5cdH1cblxuXHRnZXRDZW50ZXIoKTogUElYSS5Qb2ludCB7XG5cdFx0Y29uc3QgYm91bmRzID0gdGhpcy5ib3VuZHM7XG5cdFx0Y29uc3QgcmVjdCA9IGJvdW5kcy5nZXRSZWN0YW5nbGUoUElYSS5SZWN0YW5nbGUuRU1QVFkpO1xuXHRcdHZhciBoYWxmV2lkdGggPSByZWN0LndpZHRoIC8gMjtcblx0XHR2YXIgaGFsZkhlaWdodCA9IHJlY3QuaGVpZ2h0IC8gMjtcblx0XHRyZXR1cm4gbmV3IFBJWEkuUG9pbnQoYm91bmRzLm1pblggKyBoYWxmV2lkdGgsIGJvdW5kcy5taW5ZICsgaGFsZkhlaWdodClcblx0fVxuXG5cdHByaXZhdGUgY3JlYXRlVmVjdG9yKHRoZXRhOiBudW1iZXIsIG1hZ25pdHVkZTogUG9pbnQsIG9yaWdpbjogUG9pbnQpOiBQb2ludCB7XG5cdFx0cmV0dXJuIG5ldyBQSVhJLlBvaW50KFxuXHRcdFx0b3JpZ2luLnggKyAoTWF0aC5jb3ModGhldGEpICogbWFnbml0dWRlLngpLFxuXHRcdFx0b3JpZ2luLnkgKyAoTWF0aC5zaW4odGhldGEpICogbWFnbml0dWRlLnkpXG5cdFx0KTtcblx0fVxuXG5cdGdldFNlZ21lbnRzKGNvdW50OiBudW1iZXIpOiBQSVhJLlBvaW50W10ge1xuXHRcdGlmICh0aGlzLm1vZGUgPT0gVG9vbE1vZGUuTm90UGxhY2VkKSByZXR1cm4gW107XG5cdFx0Y29uc3QgYm91bmRzID0gdGhpcy5ib3VuZHM7XG5cdFx0Y29uc3QgcmVjdCA9IGJvdW5kcy5nZXRSZWN0YW5nbGUoUElYSS5SZWN0YW5nbGUuRU1QVFkpO1xuXHRcdHZhciBkZWx0YVRoZXRhID0gTWF0aC5QSSAvIGNvdW50O1xuXHRcdC8vIENhbGN1bGF0ZSB0aGUgbWFnbml0dWRlIHBlciBheGlzIGJhc2VkIG9uIHRoZSBzY2FsYXIgb2YgdGhlIGNpcmNsZSdzIHgseSByYWRpdXNcblx0XHRjb25zdCBtYWduaXR1ZGUgPSBuZXcgUElYSS5Qb2ludChyZWN0LndpZHRoIC8gMiwgcmVjdC5oZWlnaHQgLyAyKTtcblx0XHQvLyBGaW5kIHRoZSBleGFjdCBtaWRkbGUgcG9pbnQgb2YgdGhlIGNpcmNsZVxuXHRcdGNvbnN0IG9yaWdpbiA9IG5ldyBQSVhJLlBvaW50KGJvdW5kcy5taW5YICsgbWFnbml0dWRlLngsIGJvdW5kcy5taW5ZICsgbWFnbml0dWRlLnkpO1xuXHRcdC8vIGluaXRpYWxpemUgd2l0aCB0aGUgZmlyc3QgcG9pbnRcblx0XHRjb25zdCBwb2ludHM6IFBJWEkuUG9pbnRbXSA9IFtdO1xuXHRcdC8vIFN0YXJ0IGF0IGZ1bGwgcm90YXRpb24gYW5kIHdvcmsgb3VyIHdheSBiYWNrIENDV1xuXHRcdHZhciBhbmdsZSA9IFBJMjtcblx0XHR2YXIgc2xpY2VBbmdsZSA9IHRoaXMuc2xpY2VIYW5kbGUucmF3QW5nbGUgIT0gUEkyID8gdGhpcy5zbGljZUhhbmRsZS5yYXdBbmdsZSA6IDAuMDtcblx0XHQvLyBjb25zb2xlLmxvZyhgU2xpY2U6ICR7ZGVncmVlcyhzbGljZUFuZ2xlKX0sIEFyYzogJHtkZWdyZWVzKHRoaXMuYXJjSGFuZGxlLnJhd0FuZ2xlKX1gKTtcblx0XHR3aGlsZSAoYW5nbGUgPj0gc2xpY2VBbmdsZSkge1xuXHRcdFx0cG9pbnRzLnB1c2godGhpcy5jcmVhdGVWZWN0b3IodGhpcy5hcmNIYW5kbGUucmF3QW5nbGUgKyBhbmdsZSwgbWFnbml0dWRlLCBvcmlnaW4pKTtcblx0XHRcdGFuZ2xlIC09IGRlbHRhVGhldGE7XG5cdFx0fVxuXHRcdC8vIElmIHdlIHN0b3BwZWQgc2hvcnQgb2YgdGhlIHNsaWNlIGhhbmRsZSwgYWRkIGEgc21hbGwgc3RlcCB0byBnbyB0aGUgcmVzdCBvZiB0aGUgd2F5XG5cdFx0aWYgKENpcmNsZVRvb2wuZmluaXNoU2xpY2VJZlNob3J0ICYmIGFuZ2xlICE9IHNsaWNlQW5nbGUgJiYgc2xpY2VBbmdsZSAhPSAwKSB7XG5cdFx0XHRwb2ludHMucHVzaCh0aGlzLmNyZWF0ZVZlY3Rvcih0aGlzLmFyY0hhbmRsZS5yYXdBbmdsZSArIHNsaWNlQW5nbGUsIG1hZ25pdHVkZSwgb3JpZ2luKSk7XG5cdFx0fVxuXHRcdC8vIENsb3NlIGxvb3AgaWYgdGhlcmUgaXMgbm8gc2xpY2UsIG9yIGlmIHRoZSB1c2VyIGhhcyBsb2NrZWQgbG9vcCBjbG9zaW5nXG5cdFx0aWYgKENpcmNsZVRvb2wuY2xvc2VMb29wSWZTbGljZWQgJiYgc2xpY2VBbmdsZSAhPSAwKVxuXHRcdFx0cG9pbnRzLnB1c2gocG9pbnRzWzBdKTtcblx0XHRyZXR1cm4gKHRoaXMubGFzdFNlZ21lbnRGZXRjaCA9IHBvaW50cyk7XG5cdH1cblxuXHRpbml0aWFsUG9pbnRzKCk6IG51bWJlcltdIHsgcmV0dXJuIFswLCAwLCAwLCAwLCAwLCAwXTsgfVxuXHRkcmF3SGFuZGxlcyhjb250ZXh0OiBQSVhJLkdyYXBoaWNzKTogdm9pZCB7XG5cdFx0aWYgKHRoaXMubW9kZSA9PSBUb29sTW9kZS5Ob3RQbGFjZWQpIHJldHVybjtcblx0XHR0aGlzLmRyYXdCb3VuZGluZ0JveChjb250ZXh0KTtcblx0XHRjb25zdCBtaWRkbGUgPSB0aGlzLmdldENlbnRlcigpO1xuXHRcdGNvbnN0IGFyYyA9IHRoaXMuYXJjSGFuZGxlLmdldEhhbmRsZVBvaW50KG1pZGRsZSk7XG5cdFx0Y29uc3Qgc2xpY2UgPSB0aGlzLnNsaWNlSGFuZGxlLmdldEhhbmRsZVBvaW50KG1pZGRsZSk7XG5cdFx0Y29udGV4dC5iZWdpbkZpbGwoMHhmZmFhY2MpXG5cdFx0XHQubGluZVN0eWxlKEJlemllclRvb2wuTElORV9TSVpFLCAweGZmYWFjYywgMSwgMC41KVxuXHRcdFx0Lm1vdmVUbyh0aGlzLmxpbmVBLngsIHRoaXMubGluZUEueSlcblx0XHRcdC5saW5lVG8odGhpcy5saW5lQi54LCB0aGlzLmxpbmVCLnkpXG5cdFx0XHQubW92ZVRvKG1pZGRsZS54LCBtaWRkbGUueSlcblx0XHRcdC5saW5lVG8oYXJjLngsIGFyYy55KVxuXHRcdFx0Lm1vdmVUbyhtaWRkbGUueCwgbWlkZGxlLnkpXG5cdFx0XHQubGluZVRvKHNsaWNlLngsIHNsaWNlLnkpXG5cdFx0XHQuZW5kRmlsbCgpO1xuXHRcdHRoaXMuZHJhd1NlZ21lbnRMYWJlbChjb250ZXh0KTtcblx0XHRjb25zdCBzbmFwQW5nbGUgPSB0b0RlZ3JlZXMoQ2lyY2xlVG9vbC5BTkdMRV9TTkFQX1NURVBTW0NpcmNsZVRvb2wuc25hcFNldEluZGV4XSkudG9GaXhlZCgyKTtcblx0XHRjb25zdCBhcmNMYWJlbCA9IEJlemllclRvb2wuY3JlYXRlVGV4dChg4oeyJHtzbmFwQW5nbGV9wrAgICDil7YkezE4MCAvIHBhcnNlRmxvYXQoc25hcEFuZ2xlKX1gKTtcblx0XHRhcmNMYWJlbC5wb3NpdGlvbi5jb3B5RnJvbSh0aGlzLmxpbmVDZW50ZXIpO1xuXHRcdGFyY0xhYmVsLnBvc2l0aW9uLnkgKz0gQmV6aWVyVG9vbC5URVhUX1NUWUxFLmZvbnRTaXplIGFzIG51bWJlciArIDQ7XG5cdFx0Y29udGV4dC5hZGRDaGlsZChhcmNMYWJlbCk7XG5cdFx0dGhpcy5kcmF3SGFuZGxlKGNvbnRleHQsIDB4ZmY0NDQ0LCB0aGlzLmxpbmVBKTtcblx0XHR0aGlzLmRyYXdIYW5kbGUoY29udGV4dCwgMHhmZjQ0NDQsIHRoaXMubGluZUIpO1xuXHRcdHRoaXMuZHJhd0hhbmRsZShjb250ZXh0LCAweDQ0ZmY0NCwgdGhpcy5hcmNIYW5kbGUuZ2V0SGFuZGxlUG9pbnQodGhpcy5nZXRDZW50ZXIoKSkpO1xuXHRcdHRoaXMuZHJhd0hhbmRsZShjb250ZXh0LCAweDQ0NDRmZiwgdGhpcy5zbGljZUhhbmRsZS5nZXRIYW5kbGVQb2ludCh0aGlzLmdldENlbnRlcigpKSk7XG5cdH1cblx0cHJvdGVjdGVkIGRyYXdTZWdtZW50TGFiZWwoY29udGV4dDogUElYSS5HcmFwaGljcykge1xuXHRcdGNvbnN0IHRleHQgPSBCZXppZXJUb29sLmNyZWF0ZVRleHQoYOKGlCR7dGhpcy5sYXN0U2VnbWVudEZldGNoLmxlbmd0aCAtIDF9YCk7XG5cdFx0dGV4dC5wb3NpdGlvbiA9IHRoaXMubGluZUNlbnRlcjtcblx0XHRjb250ZXh0LmFkZENoaWxkKHRleHQpO1xuXHR9XG5cdGNoZWNrUG9pbnRGb3JEcmFnKHBvaW50OiBQb2ludCk6IElucHV0SGFuZGxlciB8IG51bGwge1xuXHRcdGlmICh0aGlzLm1vZGUgPT0gVG9vbE1vZGUuTm90UGxhY2VkKSB7XG5cdFx0XHR0aGlzLnNldE1vZGUoVG9vbE1vZGUuUGxhY2luZyk7XG5cdFx0XHRyZXR1cm4gbmV3IEluaXRpYWxpemVySUgodGhpcywgKCkgPT4gdGhpcy5zZXRNb2RlKFRvb2xNb2RlLlBsYWNlZCksICgpID0+IHRoaXMuc2V0TW9kZShUb29sTW9kZS5Ob3RQbGFjZWQpKTtcblx0XHR9XG5cdFx0aWYgKHBvaW50TmVhclBvaW50KHBvaW50LCB0aGlzLmxpbmVBLCBCZXppZXJUb29sLkhBTkRMRV9SQURJVVMpKVxuXHRcdFx0cmV0dXJuIG5ldyBQb2ludElucHV0SGFuZGxlcih0aGlzLmxpbmVBKTtcblx0XHRlbHNlIGlmIChwb2ludE5lYXJQb2ludChwb2ludCwgdGhpcy5saW5lQiwgQmV6aWVyVG9vbC5IQU5ETEVfUkFESVVTKSlcblx0XHRcdHJldHVybiBuZXcgUG9pbnRJbnB1dEhhbmRsZXIodGhpcy5saW5lQik7XG5cdFx0ZWxzZSBpZiAocG9pbnROZWFyUG9pbnQocG9pbnQsIHRoaXMuYXJjSGFuZGxlLmdldEhhbmRsZVBvaW50KHRoaXMuZ2V0Q2VudGVyKCkpLCBCZXppZXJUb29sLkhBTkRMRV9SQURJVVMpKVxuXHRcdFx0cmV0dXJuIG5ldyBQb2ludFJvdGF0aW9uSGFuZGxlcih0aGlzLmFyY0hhbmRsZSwgdGhpcy5nZXRDZW50ZXIoKSk7XG5cdFx0ZWxzZSBpZiAocG9pbnROZWFyUG9pbnQocG9pbnQsIHRoaXMuc2xpY2VIYW5kbGUuZ2V0SGFuZGxlUG9pbnQodGhpcy5nZXRDZW50ZXIoKSksIEJlemllclRvb2wuSEFORExFX1JBRElVUykpXG5cdFx0XHRyZXR1cm4gbmV3IFBvaW50Um90YXRpb25IYW5kbGVyKHRoaXMuc2xpY2VIYW5kbGUsIHRoaXMuZ2V0Q2VudGVyKCkpO1xuXHRcdGVsc2UgaWYgKHRoaXMucG9seWdvbi5jb250YWlucyhwb2ludC54LCBwb2ludC55KSlcblx0XHRcdHJldHVybiBuZXcgUG9pbnRBcnJheUlucHV0SGFuZGxlcihwb2ludCwgdGhpcy5oYW5kbGVzKTtcblx0XHRyZXR1cm4gbnVsbDtcblx0fVxufVxuXG5jbGFzcyBSb3RhdG9ySGFuZGxlIHtcblx0cHJpdmF0ZSBfYW5nbGU6IG51bWJlciA9IDAuMDtcblx0Z2V0IHJhd0FuZ2xlKCk6IG51bWJlciB7IHJldHVybiB0aGlzLl9hbmdsZTsgfVxuXHRzZXQgcmF3QW5nbGUodmFsdWU6IG51bWJlcikgeyB0aGlzLl9hbmdsZSA9IHZhbHVlOyB9XG5cdGdldCBhbmdsZSgpOiBudW1iZXIge1xuXHRcdHJldHVybiAhIXRoaXMubWFnbmV0ID8gdGhpcy5fYW5nbGUgKyB0aGlzLm1hZ25ldC5fYW5nbGUgOiB0aGlzLl9hbmdsZTtcblx0fVxuXHRzZXQgYW5nbGUodmFsdWU6IG51bWJlcikge1xuXHRcdHRoaXMuX2FuZ2xlID0gISF0aGlzLm1hZ25ldCA/IHZhbHVlIC0gdGhpcy5tYWduZXQuX2FuZ2xlIDogdGhpcy5fYW5nbGUgPSB2YWx1ZTtcblx0fVxuXHRwcml2YXRlIGxlbmd0aDogbnVtYmVyID0gMC4wO1xuXHRtYWduZXQ6IFJvdGF0b3JIYW5kbGU7XG5cdGNvbnN0cnVjdG9yKGxlbmd0aDogbnVtYmVyLCBtYWduZXQ/OiBSb3RhdG9ySGFuZGxlKSB7XG5cdFx0dGhpcy5sZW5ndGggPSBsZW5ndGg7XG5cdFx0dGhpcy5tYWduZXQgPSBtYWduZXQ7XG5cdH1cblx0Z2V0SGFuZGxlUG9pbnQoY2VudGVyOiBQSVhJLlBvaW50KTogUElYSS5Qb2ludCB7XG5cdFx0Y29uc3QgbWFnbmV0ID0gISF0aGlzLm1hZ25ldCA/IHRoaXMubWFnbmV0Ll9hbmdsZSA6IDA7XG5cdFx0Y29uc3QgYXggPSBNYXRoLmNvcyhtYWduZXQgKyB0aGlzLl9hbmdsZSkgKiB0aGlzLmxlbmd0aDtcblx0XHRjb25zdCBheSA9IE1hdGguc2luKG1hZ25ldCArIHRoaXMuX2FuZ2xlKSAqIHRoaXMubGVuZ3RoO1xuXHRcdHJldHVybiBuZXcgUElYSS5Qb2ludChjZW50ZXIueCArIGF4LCBjZW50ZXIueSArIGF5KTtcblx0fVxufVxuXG5jbGFzcyBQb2ludFJvdGF0aW9uSGFuZGxlciBleHRlbmRzIElucHV0SGFuZGxlciB7XG5cdHByaXZhdGUgb3JpZ2luYWw6IG51bWJlcjtcblx0cHJpdmF0ZSBhcmNIYW5kbGU6IFJvdGF0b3JIYW5kbGU7XG5cdHByaXZhdGUgY2VudGVyOiBQSVhJLlBvaW50O1xuXHRjb25zdHJ1Y3RvcihhcmNIYW5kbGU6IFJvdGF0b3JIYW5kbGUsIGNlbnRlcjogUElYSS5Qb2ludCkge1xuXHRcdHN1cGVyKCk7XG5cdFx0dGhpcy5hcmNIYW5kbGUgPSBhcmNIYW5kbGU7XG5cdFx0dGhpcy5vcmlnaW5hbCA9IHRoaXMuYXJjSGFuZGxlLmFuZ2xlO1xuXHRcdHRoaXMuY2VudGVyID0gY2VudGVyO1xuXHR9XG5cblx0c2V0QW5nbGUodG86IFBJWEkuUG9pbnQsIGV2ZW50OiBQSVhJLkludGVyYWN0aW9uRXZlbnQpIHtcblx0XHRjb25zdCB2ZWNYID0gdG8ueCAtIHRoaXMuY2VudGVyLng7XG5cdFx0Y29uc3QgdmVjWSA9IHRvLnkgLSB0aGlzLmNlbnRlci55O1xuXHRcdC8vIGNhbGN1bGF0ZSB0aGUgcmVmZXJlbmNlIGFuZ2xlIHRoZXRhIGJhciAozZ7OuClcblx0XHR2YXIgYW5nbGUgPSBNYXRoLmF0YW4odmVjWSAvIHZlY1gpO1xuXHRcdC8vIElmIG9uIHRoZSAtWCBheGlzICgybmQgYW5kIDNyZCBxdWFkcmFudHMpXG5cdFx0aWYgKHZlY1ggPCAwKSBhbmdsZSArPSBNYXRoLlBJO1xuXHRcdC8vIFNwZWNpZmljYWxseSB0aGUgK1gsLVkgcXVhZHJhbnQgKDR0aCBxdWFkcmFudClcblx0XHRlbHNlIGlmICh2ZWNZIDwgMCkgYW5nbGUgKz0gUEkyO1xuXHRcdC8vIFBlcmZvcm0gc25hcHBpbmcgaWYgZW5hYmxlZFxuXHRcdGlmICh0aGlzLnNob3VsZFNuYXAoZXZlbnQpKSB7XG5cdFx0XHRjb25zdCBzbmFwQW5nbGUgPSBDaXJjbGVUb29sLkFOR0xFX1NOQVBfU1RFUFNbQ2lyY2xlVG9vbC5zbmFwU2V0SW5kZXhdO1xuXHRcdFx0Ly8gV2hvbGUgbnVtYmVyIG9mIGFuZ2xlIHNuYXBzXG5cdFx0XHRjb25zdCB3aG9sZSA9IE1hdGgudHJ1bmMoYW5nbGUgLyBzbmFwQW5nbGUpO1xuXHRcdFx0Ly8gUm91bmQgdG8gdGhlIG5lYXJlc3Qgd2hvbGUgYW5nbGUgc25hcFxuXHRcdFx0YW5nbGUgPSAoYW5nbGUgLSAod2hvbGUgKiBzbmFwQW5nbGUpKSA8IChzbmFwQW5nbGUgLyAyKVxuXHRcdFx0XHQ/IHdob2xlICogc25hcEFuZ2xlXG5cdFx0XHRcdDogKHdob2xlICsgMSkgKiBzbmFwQW5nbGU7XG5cdFx0fVxuXHRcdGNvbnN0IG1hZ25ldCA9ICEhdGhpcy5hcmNIYW5kbGUubWFnbmV0ID8gKFBJMiAtIHRoaXMuYXJjSGFuZGxlLm1hZ25ldC5yYXdBbmdsZSkgOiAwXG5cdFx0dGhpcy5hcmNIYW5kbGUucmF3QW5nbGUgPSAobWFnbmV0ICsgYW5nbGUpICUgUEkyO1xuXHR9XG5cblx0c3RhcnQoX29yaWdpbjogUElYSS5Qb2ludCwgZGVzdGluYXRpb246IFBJWEkuUG9pbnQsIGV2ZW50OiBQSVhJLkludGVyYWN0aW9uRXZlbnQpOiB2b2lkIHtcblx0XHR0aGlzLnNldEFuZ2xlKGRlc3RpbmF0aW9uLCBldmVudCk7XG5cdH1cblx0bW92ZShfb3JpZ2luOiBQSVhJLlBvaW50LCBkZXN0aW5hdGlvbjogUElYSS5Qb2ludCwgZXZlbnQ6IFBJWEkuSW50ZXJhY3Rpb25FdmVudCk6IHZvaWQge1xuXHRcdHRoaXMuc2V0QW5nbGUoZGVzdGluYXRpb24sIGV2ZW50KTtcblx0fVxuXHRzdG9wKF9vcmlnaW46IFBJWEkuUG9pbnQsIGRlc3RpbmF0aW9uOiBQSVhJLlBvaW50LCBldmVudDogUElYSS5JbnRlcmFjdGlvbkV2ZW50KTogdm9pZCB7XG5cdFx0dGhpcy5zZXRBbmdsZShkZXN0aW5hdGlvbiwgZXZlbnQpO1xuXHR9XG5cdGNhbmNlbCgpOiB2b2lkIHtcblx0XHR0aGlzLmFyY0hhbmRsZS5hbmdsZSA9IHRoaXMub3JpZ2luYWw7XG5cdH1cbn0iXX0=
